<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudBuddy - Real-Time Weather Forecast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .weather-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .dark .gradient-bg {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
        }
        
        .weather-icon {
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen gradient-bg transition-all duration-300">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fas fa-cloud-sun text-4xl text-white mr-3"></i>
                <h1 class="text-3xl font-bold text-white">CloudBuddy</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <input 
                        type="text" 
                        id="locationInput"
                        placeholder="Search city or zip code..."
                        class="pl-4 pr-12 py-3 rounded-full bg-white/20 backdrop-blur-md text-white placeholder-white/70 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50 w-64"
                    >
                    <button onclick="searchWeather()" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-white hover:text-blue-200 transition-colors">
                        <i class="fas fa-search text-lg"></i>
                    </button>
                </div>
                
                <button onclick="getCurrentLocation()" class="p-3 rounded-full bg-white/20 backdrop-blur-md text-white hover:bg-white/30 transition-all" title="Use my location">
                    <i class="fas fa-location-arrow"></i>
                </button>
                
                <button onclick="toggleDarkMode()" class="p-3 rounded-full bg-white/20 backdrop-blur-md text-white hover:bg-white/30 transition-all" title="Toggle dark mode">
                    <i class="fas fa-moon" id="darkModeIcon"></i>
                </button>

                <button onclick="logoutUser()" class="px-6 py-3 rounded-full bg-red-500/80 text-white font-medium hover:bg-red-600 transition-all ml-2">
    Logout
</button>

                
                <button onclick="toggleUnit()" class="p-3 rounded-full bg-white/20 backdrop-blur-md text-white hover:bg-white/30 transition-all" title="¬∞C / ¬∞F" id="unitButton">
                    <i class="fas fa-thermometer-half"></i>
                </button>
            </div>
        </header>

        <!-- Loading State -->
        <div id="loadingState" class="hidden text-center py-20">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-white text-lg">Fetching real-time weather data...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden text-center py-20">
            <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4"></i>
            <p id="errorMessage" class="text-white text-lg mb-4">Unable to fetch weather data</p>
            <button onclick="retryWeather()" class="px-6 py-3 bg-white/20 backdrop-blur-md text-white rounded-full hover:bg-white/30 transition-all">
                Try Again
            </button>
        </div>

        <!-- Main Weather Content -->
        <div id="weatherContent" class="hidden">
            <!-- Current Weather -->
            <div class="weather-card rounded-3xl p-8 mb-8 slide-in">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="text-center md:text-left mb-6 md:mb-0">
                        <div class="flex items-center justify-center md:justify-start mb-2">
                            <i class="fas fa-map-marker-alt text-white/70 mr-2"></i>
                            <span id="currentLocation" class="text-white/90 text-lg">Loading...</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start mb-4">
                            <span id="currentTemp" class="text-6xl font-light text-white mr-4">--¬∞</span>
                            <div class="text-center">
                                <div id="weatherIcon" class="text-5xl mb-2 weather-icon">üå§Ô∏è</div>
                                <span id="weatherDescription" class="text-white/90 capitalize">Loading...</span>
                            </div>
                        </div>
                        <p class="text-white/70 text-lg">Feels like <span id="feelsLike">--¬∞</span></p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6 text-center">
                        <div class="weather-card rounded-2xl p-4">
                            <i class="fas fa-tint text-blue-300 text-2xl mb-2"></i>
                            <p class="text-white/70 text-sm">Humidity</p>
                            <p id="humidity" class="text-white text-xl font-semibold">--%</p>
                        </div>
                        <div class="weather-card rounded-2xl p-4">
                            <i class="fas fa-wind text-green-300 text-2xl mb-2"></i>
                            <p class="text-white/70 text-sm">Wind</p>
                            <p id="windSpeed" class="text-white text-xl font-semibold">--</p>
                        </div>
                        <div class="weather-card rounded-2xl p-4">
                            <i class="fas fa-thermometer-half text-orange-300 text-2xl mb-2"></i>
                            <p class="text-white/70 text-sm">Pressure</p>
                            <p id="pressure" class="text-white text-xl font-semibold">-- hPa</p>
                        </div>
                        <div class="weather-card rounded-2xl p-4">
                            <i class="fas fa-eye text-purple-300 text-2xl mb-2"></i>
                            <p class="text-white/70 text-sm">Visibility</p>
                            <p id="visibility" class="text-white text-xl font-semibold">-- km</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hourly Forecast -->
            <div class="weather-card rounded-3xl p-6 mb-8 slide-in">
                <h2 class="text-2xl font-semibold text-white mb-6 flex items-center">
                    <i class="fas fa-clock mr-3"></i>
                    Next 48 Hours
                </h2>
                <div id="hourlyForecast" class="flex overflow-x-auto space-x-4 pb-4">
                    <!-- Hourly items populated by JavaScript -->
                </div>
            </div>

            <!-- 7-Day Forecast -->
            <div class="weather-card rounded-3xl p-6 mb-8 slide-in">
                <h2 class="text-2xl font-semibold text-white mb-6 flex items-center">
                    <i class="fas fa-calendar-week mr-3"></i>
                    7-Day Forecast
                </h2>
                <div id="weeklyForecast" class="space-y-4">
                    <!-- Weekly items populated by JavaScript -->
                </div>
            </div>

            <!-- Additional Info -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="weather-card rounded-3xl p-6 slide-in">
                    <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                        <i class="fas fa-sun text-yellow-300 mr-3"></i>
                        Sun & Moon
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-white/70">Sunrise</span>
                            <span id="sunrise" class="text-white">--:--</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-white/70">Sunset</span>
                            <span id="sunset" class="text-white">--:--</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-white/70">UV Index</span>
                            <span id="uvIndex" class="text-white">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="weather-card rounded-3xl p-6 slide-in">
                    <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                        <i class="fas fa-thermometer-quarter text-blue-300 mr-3"></i>
                        Temperature Range
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-white/70">Today's High</span>
                            <span id="tempMax" class="text-white">--¬∞</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-white/70">Today's Low</span>
                            <span id="tempMin" class="text-white">--¬∞</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-white/70">Air Quality</span>
                            <span id="airQuality" class="text-white">Good</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-white/70 py-6">
            <p>&copy; 2025 SkyCast. Real-time data from <a href="https://openweathermap.org" class="hover:text-white transition-colors">OpenWeatherMap API</a>[web:1].</p>
        </footer>
    </div>

    
    <script>

         function logoutUser() {
    if (confirm('Are you sure you want to logout?')) {
        // Clear local data
        localStorage.clear();
        // Redirect to login or home
        window.location.href = 'login.html'; // or window.location.reload();
        // Or just show alert for demo
        alert('Logged out successfully!');
    }
}



let currentUnit = 'metric';
let currentLocationData = null;
let isDarkMode = false;

const weatherIcons = {
    '0': '‚òÄÔ∏è', '1': '‚òÄÔ∏è', '2': '‚õÖ', '3': '‚òÅÔ∏è', '45': 'üå´Ô∏è', '48': 'üå´Ô∏è',
    '51': 'üå¶Ô∏è', '53': 'üå¶Ô∏è', '55': 'üåßÔ∏è', '61': 'üå¶Ô∏è', '63': 'üåßÔ∏è', '65': 'üåßÔ∏è',
    '71': '‚ùÑÔ∏è', '73': '‚ùÑÔ∏è', '75': '‚ùÑÔ∏è', '77': '‚ùÑÔ∏è', '80': 'üå¶Ô∏è', '95': '‚õàÔ∏è'
};

document.addEventListener('DOMContentLoaded', function() {
    getCurrentLocation();
    document.getElementById('locationInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') searchWeather();
    });
});

async function getCurrentLocation() {
    showLoading();
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            async (position) => {
                await fetchWeatherByCoords(position.coords.latitude, position.coords.longitude);
            },
            () => searchWeather('Kochi')
        );
    } else {
        searchWeather('Kochi');
    }
}

async function searchWeather() {
    const location = document.getElementById('locationInput').value.trim() || 'Kochi';
    showLoading();
    document.getElementById('locationInput').value = '';
    await fetchOpenMeteoWeather(location);
}

async function fetchOpenMeteoWeather(city) {
    try {
        // Find city coordinates
        const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en`;
        const geoRes = await fetch(geoUrl);
        const geoData = await geoRes.json();
        
        if (!geoData.results?.[0]) throw new Error(`"${city}" not found. Try "Kochi" or "Delhi"`);
        
        const { latitude, longitude, name } = geoData.results[0];
        
        // Get weather
        const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,uv_index_max&timezone=auto`;
        const res = await fetch(weatherUrl);
        const data = await res.json();
        
        currentLocationData = { name: name || city, ...data };
        displayWeatherData(currentLocationData);
        hideLoading();
    } catch (error) {
        showError(error.message);
    }
}

async function fetchWeatherByCoords(lat, lon) {
    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,uv_index_max&timezone=auto`;
    const res = await fetch(weatherUrl);
    const data = await res.json();
    currentLocationData = { name: 'Your Location', ...data };
    displayWeatherData(currentLocationData);
    hideLoading();
}

function displayWeatherData(data) {
    const current = data.current;
    const daily = data.daily || {};
    
    // Current weather - SAFE checks
    document.getElementById('currentLocation').textContent = data.name || 'Loading...';
    document.getElementById('currentTemp').textContent = `${Math.round(current.temperature_2m || 0)}¬∞`;
    document.getElementById('weatherIcon').textContent = weatherIcons[current.weather_code] || 'üå§Ô∏è';
    document.getElementById('weatherDescription').textContent = getWeatherDescription(current.weather_code);
    document.getElementById('feelsLike').textContent = `${Math.round(current.apparent_temperature || 0)}¬∞`;
    document.getElementById('humidity').textContent = `${current.relative_humidity_2m || 0}%`;
    document.getElementById('windSpeed').textContent = `${Math.round((current.wind_speed_10m || 0) * 3.6)} km/h`;
    document.getElementById('pressure').textContent = `-- hPa`;
    document.getElementById('visibility').textContent = `-- km`;
    
    // Sun/Moon/Temp - SAFE checks
    if (daily.sunrise && daily.sunrise[0]) {
        document.getElementById('sunrise').textContent = new Date(daily.sunrise[0]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    } else {
        document.getElementById('sunrise').textContent = '--:--';
    }
    
    if (daily.sunset && daily.sunset[0]) {
        document.getElementById('sunset').textContent = new Date(daily.sunset[0]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    } else {
        document.getElementById('sunset').textContent = '--:--';
    }
    
    document.getElementById('uvIndex').textContent = daily.uv_index_max?.[0]?.toFixed(1) || '--';
    document.getElementById('tempMax').textContent = daily.temperature_2m_max ? `${Math.round(daily.temperature_2m_max[0])}¬∞` : '--¬∞';
    document.getElementById('tempMin').textContent = daily.temperature_2m_min ? `${Math.round(daily.temperature_2m_min[0])}¬∞` : '--¬∞';

    // Forecasts
    displayHourlyForecast(data.hourly || []);
    displayWeeklyForecast(daily);
}


function getWeatherDescription(code) {
    const desc = {
        0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
        45: 'Fog', 48: 'Rime fog', 51: 'Light drizzle', 53: 'Drizzle',
        55: 'Heavy drizzle', 61: 'Light rain', 63: 'Rain', 65: 'Heavy rain',
        71: 'Light snow', 73: 'Snow', 75: 'Heavy snow', 95: 'Thunderstorm'
    };
    return desc[code] || 'Weather';
}

function displayHourlyForecast(hourly) {
    if (!hourly || !hourly.time) {
        document.getElementById('hourlyForecast').innerHTML = '<p class="text-white/70 text-center py-4">Hourly forecast unavailable</p>';
        return;
    }

    const next12 = [];
    const maxHours = Math.min(hourly.time.length, 12);
    for (let i = 0; i < maxHours; i++) {
        next12.push({
            time: new Date(hourly.time[i]).toLocaleTimeString([], {hour: 'numeric'}),
            temp: Math.round(hourly.temperature_2m[i]),
            icon: hourly.weather_code?.[i] || 0
        });
    }
    
    document.getElementById('hourlyForecast').innerHTML = next12.map(h => `
        <div class="flex-shrink-0 text-center p-4 weather-card rounded-2xl min-w-[90px]">
            <p class="text-white/70 text-xs mb-2">${h.time}</p>
            <div class="text-2xl mb-2">${weatherIcons[h.icon] || 'üå§Ô∏è'}</div>
            <p class="text-white font-semibold">${h.temp}¬∞</p>
        </div>
    `).join('');
}


function displayWeeklyForecast(daily) {
    if (!daily || !daily.time) {
        document.getElementById('weeklyForecast').innerHTML = '<p class="text-white/70 text-center py-8">Forecast unavailable</p>';
        return;
    }

    const days = ['Today', 'Tomorrow', 'Wed', 'Thu', 'Fri', 'Sat'];
    const weekly = [];
    
    // Only use available data
    const maxDays = Math.min(daily.time.length, 6);
    for (let i = 0; i < maxDays; i++) {
        weekly.push({
            day: days[i],
            high: Math.round(daily.temperature_2m_max[i]),
            low: Math.round(daily.temperature_2m_min[i]),
            icon: daily.weather_code?.[i] || 0  // Default to clear sky
        });
    }
    
    document.getElementById('weeklyForecast').innerHTML = weekly.map(day => `
        <div class="flex items-center justify-between p-4 weather-card rounded-2xl">
            <div class="flex items-center space-x-4">
                <div class="text-3xl">${weatherIcons[day.icon] || 'üå§Ô∏è'}</div>
                <div>
                    <p class="text-white font-semibold">${day.day}</p>
                    <p class="text-white/70 text-sm">${getWeatherDescription(day.icon)}</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-white font-semibold">${day.high}¬∞</p>
                <p class="text-white/70">${day.low}¬∞</p>
            </div>
        </div>
    `).join('');
}


// Utility functions (keep these)
function showLoading() {
    document.getElementById('loadingState').classList.remove('hidden');
    document.getElementById('weatherContent').classList.add('hidden');
    document.getElementById('errorState').classList.add('hidden');
}

function hideLoading() {
    document.getElementById('loadingState').classList.add('hidden');
    document.getElementById('weatherContent').classList.remove('hidden');
}

function showError(message) {
    document.getElementById('errorMessage').textContent = message;
    document.getElementById('errorState').classList.remove('hidden');
    document.getElementById('weatherContent').classList.add('hidden');
    document.getElementById('loadingState').classList.add('hidden');
}

function toggleDarkMode() {
    isDarkMode = !isDarkMode;
    document.body.classList.toggle('dark');
    document.getElementById('darkModeIcon').className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
}

function toggleUnit() {
    currentUnit = currentUnit === 'metric' ? 'imperial' : 'metric';
    if (currentLocationData) getCurrentLocation();
}
</script>





</body>
</html>
